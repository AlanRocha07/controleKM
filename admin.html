
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Administração – Usuários</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="p-3">
  <h3>Painel de Administração</h3>
  <button id="exportExcel" class="btn btn-primary mb-3">Exportar Excel</button>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>Status</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody id="userList"></tbody>
  </table>

<script>
// Configuração do Firebase (use a mesma do seu app principal)
firebase.initializeApp(firebaseConfig);

async function loadUsers() {
  const snapshot = await firebase.firestore().collection('users').get();
  const tbody = document.getElementById('userList');
  tbody.innerHTML = "";
  snapshot.forEach(doc => {
    const data = doc.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${data.name || ''}</td>
      <td>${data.email}</td>
      <td>${data.revoked ? 'Revogado' : 'Ativo'}</td>
      <td>
        <button class="btn btn-sm ${data.revoked ? 'btn-success' : 'btn-danger'}" onclick="toggleAccess('${doc.id}', ${!data.revoked})">
          ${data.revoked ? 'Restaurar' : 'Revogar'}
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function toggleAccess(uid, revoke) {
  await firebase.firestore().collection('users').doc(uid).update({ revoked: revoke });
  loadUsers();
}

document.getElementById('exportExcel').addEventListener('click', async () => {
  const snapshot = await firebase.firestore().collection('users').get();
  const users = [];
  snapshot.forEach(doc => users.push(doc.data()));
  const ws = XLSX.utils.json_to_sheet(users);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Usuários");
  XLSX.writeFile(wb, 'usuarios.xlsx');
});

firebase.auth().onAuthStateChanged(user => {
  if (user && user.email === "alansrocha@gmail.com") {
    loadUsers();
  } else {
    document.body.innerHTML = "<h4>Acesso negado</h4>";
  }
});
</script>
</body>
</html>
